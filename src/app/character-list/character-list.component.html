<div id="pun-main" class="main character-list">
  <div class="main-header">
    <h1><span>Список персонажей</span></h1>
  </div>

  <div class="character-tree">
    <!-- Loop over the grouped factions -->
    @for (group of groupedCharacterList(); track group[0]?.id || $index) {
      <div class="category">
        <!-- Level 0 Header -->
        <div class="maintitle">
          <h2 class="faction-title"><span>{{ group[0].name }}</span></h2>
        </div>

        <div class="main-content">
          @if (group[0].characters && group[0].characters.length > 0) {
            <ul class="character-group">
              @for (char of group[0].characters; track char.id) {
                <li class="character-item">
                  <a [routerLink]="['/character', char.id]" class="character-link">
                    {{ char.name }}
                  </a>
                  @if (char.character_status !== undefined && char.character_status !== null) {
                    <span class="character-status">({{ getStatusLabel(char.character_status) }})</span>
                  }
                </li>
              }
            </ul>
          }

          <!-- Loop over the rest of the factions in the group (levels 1+) -->
          @for (faction of group.slice(1); track faction.id) {
            <div class="faction-block" [class.level-1]="faction.level === 1" [class.level-2]="faction.level >= 2">
              @switch (faction.level) {
                @case (1) { <h3 class="faction-title">{{ faction.name }}</h3> }
                @case (2) { <h4 class="faction-title">{{ faction.name }}</h4> }
                @default { <h5 class="faction-title">{{ faction.name }}</h5> }
              }

              @if (faction.characters && faction.characters.length > 0) {
                <ul class="character-group">
                  @for (char of faction.characters; track char.id) {
                    <li class="character-item">
                      <a [routerLink]="['/character', char.id]" class="character-link">
                        {{ char.name }}
                      </a>
                      @if (char.character_status !== undefined && char.character_status !== null) {
                        <span class="character-status">({{ getStatusLabel(char.character_status) }})</span>
                      }
                    </li>
                  }
                </ul>
              }
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
