<div id="pun-main" class="main episode-dashboard">
  <div class="main-header">
    <h1><span i18n="@@episodelist.title">Game Episodes</span></h1>
  </div>

  <div class="dashboard-layout">
    <aside class="filter-sidebar">
      <h3 i18n="@@episodelist.filters">Filters</h3>

      <div class="filter-group">
        <h4 i18n="@@episodelist.sections">Sections</h4>
        <div class="checkbox-list">
          @for (forum of subforums(); track forum.id) {
            <label>
              <input type="checkbox" [checked]="isSelected(forum.id)" (change)="toggleForum(forum.id)">
              {{ forum.name }}
            </label>
          }
        </div>
      </div>

      <div class="filter-group">
        <h4 i18n="@@episodelist.characters">Characters</h4>
        <div class="autocomplete-wrapper">
          <input
            type="text"
            placeholder="Search character..."
            i18n-placeholder="@@episodelist.searchCharacter"
            [(ngModel)]="characterSearchQuery"
            (ngModelChange)="onSearchChange()">
          @if (characterSuggestions().length > 0) {
            <div class="suggestions-dropdown">
              @for (character of characterSuggestions(); track character.id) {
                <div class="suggestion-item" (click)="selectCharacter(character)">
                  <span>{{ character.name }}</span>
                </div>
              }
            </div>
          }
          <div class="selected-tags">
            @for (char of selectedCharacters; track char.id) {
              <span class="tag">{{ char.name }} <i (click)="removeChar(char.id)">Ã—</i></span>
            }
          </div>
        </div>
      </div>

      <div class="filter-group">
        <h4 i18n="@@episodelist.factions">Factions</h4>
        <div class="checkbox-list">
          @for (faction of factions(); track faction.id) {
            <label [style.padding-left.rem]="faction.level > 0 ? faction.level * 1.5 : 0">
              <input type="checkbox" (change)="toggleGroup(faction)">
              {{ faction.name }}
            </label>
          }
        </div>
      </div>

      <button class="button" (click)="applyFilters()" i18n="@@episodelist.applyFilters">Apply Filters</button>
    </aside>

    <section class="table-area">
      <div class="search-bar">
        <input type="text" placeholder="Search by topic title..." i18n-placeholder="@@episodelist.searchByTopicTitle" [(ngModel)]="searchQuery">
      </div>

      <table class="episode-table" cellspacing="0">
        <thead>
        <tr>
          <th class="tcl" i18n="@@episodelist.topicTitle">Topic Title</th>
          <th class="tc2" i18n="@@episodelist.subforum">Subforum</th>
          <th class="tc3" i18n="@@episodelist.status">Status</th>
          <th class="tc4" i18n="@@episodelist.lastPost">Last Post Date</th>
        </tr>
        </thead>
        <tbody>
          @for (topic of topics(); track topic.id) {
            <tr>
              <td class="tcl">
                <a [routerLink]="['/topic', topic.id]" class="topic-link">{{ topic.name }}</a>
              </td>
              <td class="tc2"><a [routerLink]="['/subforum', topic.subforum_id]">{{ topic.subforum_name }}</a></td>
              <td class="tc3">
                  @if (topic.topic_status === TopicStatus.active) {
                    <ng-container i18n="@@episodelist.inProgress">In Progress</ng-container>
                  } @else {
                    <ng-container i18n="@@episodelist.completed">Completed</ng-container>
                  }
              </td>
              <td class="tc4">
                {{ topic.last_post_date }}
              </td>
            </tr>
          }
        </tbody>
      </table>

      <div class="pagination">
        <button [disabled]="currentPage === 1" i18n="@@episodelist.previous">Previous</button>
        <span>
          <ng-container i18n="@@episodelist.page">Page</ng-container> {{ currentPage }} <ng-container i18n="@@episodelist.of">of</ng-container> {{ totalPages }}
        </span>
        <button [disabled]="currentPage === totalPages" i18n="@@episodelist.next">Next</button>
      </div>
    </section>
  </div>
</div>
